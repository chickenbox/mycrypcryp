var com,DanborutoriReact,mycrypcryp,__awaiter=this&&this.__awaiter||function(a,s,o,l){return new(o=o||Promise)(function(e,t){function n(e){try{r(l.next(e))}catch(e){t(e)}}function i(e){try{r(l.throw(e))}catch(e){t(e)}}function r(t){t.done?e(t.value):new o(function(e){e(t.value)}).then(n,i)}r((l=l.apply(a,s||[])).next())})};!function(e){(e.view||(e.view={})).Loading=class{constructor(){this.htmlElement=DanborutoriReact.createElement("div",{style:"position: absolute; left: 50%; top: 50%; transform: translate(-50%,-50%); background-color: white; border-radius: 4px; padding: 4px;"},"loading")}}}(mycrypcryp=mycrypcryp||{}),function(e){(function(e){class t{getPrice(e,t){return __awaiter(this,void 0,void 0,function*(){return(yield(yield fetch(`https://min-api.cryptocompare.com/data/price?fsym=${e}&tsyms=${t}`)).json())[t]})}}t.shared=new t,e.CryptoCompare=t})((e=e.danborutori||(e.danborutori={})).cryptoApi||(e.cryptoApi={}))}(com=com||{}),function(e){(function(e){class t{fullUrl(e){return`https://api.binance.com/api/v3${e}`}getExchangeInfo(){return __awaiter(this,void 0,void 0,function*(){const e=yield fetch(this.fullUrl("/exchangeInfo"));return yield e.json()})}getKlineCandlestickData(i,r,a){return __awaiter(this,void 0,void 0,function*(){const e=new URLSearchParams({symbol:i,interval:r});for(var t in a=a||{})e.append(t,a[t]);const n=yield fetch(this.fullUrl("/klines")+"?"+e);return(yield n.json()).map(e=>({openTime:new Date(e[0]),open:parseFloat(e[1]),high:parseFloat(e[2]),low:parseFloat(e[3]),close:parseFloat(e[4]),volume:parseFloat(e[5]),closeTime:new Date(e[6]),quoteAssetVolume:parseFloat(e[7]),numberOfTrades:parseInt(e[8]),takerBuyBaseAssetVolume:parseFloat(e[9]),takerBuyQuoteAssetVolume:parseFloat(e[10])}))})}}t.shared=new t,e.Binance=t})((e=e.danborutori||(e.danborutori={})).cryptoApi||(e.cryptoApi={}))}(com=com||{}),function(o){o.createElement=function(e,t,...n){let i;switch(e){case"button":i=o.createElement("input",{type:"button"});break;case"checkbox":i=o.createElement("input",{type:"checkbox"});break;case"radio":i=o.createElement("input",{type:"radio"});break;case"file":i=o.createElement("input",{type:"file"});break;case"scroll":i=o.createElement("div",null),i.style.overflow="scroll";break;case"slider":i=o.createElement("input",{type:"range"});break;default:i=document.createElement(e)}if(t)for(var r in t)t.hasOwnProperty(r)&&(r.startsWith("on")?i.addEventListener(r.substring(2),t[r]):i.setAttribute(r,t[r]));var a,s;for(a of n.flatMap(e=>e))a instanceof HTMLElement?i.appendChild(a):(s=document.createTextNode(a),i.appendChild(s));return i}}(DanborutoriReact=DanborutoriReact||{}),Object.defineProperty(Array.prototype,"first",{get(){return 0<this.length?this[0]:null}}),Object.defineProperty(Array.prototype,"last",{get(){return 0<this.length?this[this.length-1]:null}}),Array.prototype.findClosestIndex=function(t,e){let n=-1,i=1/0;for(let e=0;e<this.length;e++){var r=t(this[e],e);r<i&&(i=r,n=e)}return e&&(e.minDistance=i),n},Array.prototype.insert=function(e,t){this.splice(t,0,e)},Array.prototype.remove=function(e){var t=this[e];return this.splice(e,1),t},Array.prototype.swap=function(e,t){var n=this[e];this[e]=this[t],this[t]=n},Array.prototype.clear=function(){this.length=0},Array.prototype.pushAll=function(e){for(var t of e)this.push(t)},Array.prototype.flatMap=function(t){let n=new Array;for(let e=0;e<this.length;e++){var i=t(this[e],e);if(i instanceof Array)for(var r of i)null!=r&&null!=r&&n.push(r);else null!=i&&null!=i&&n.push(i)}return n},function(e){e.version="0.0.1";e.App=class{run(){return __awaiter(this,void 0,void 0,function*(){document.body.append((new e.scene.Landing).htmlElement)})}}}(mycrypcryp=mycrypcryp||{}),function(e){(e.helper||(e.helper={})).GraphDrawer=class{constructor(e){this.canvas=e;const t=this.canvas.getContext("2d");t.fillStyle="white",t.fillRect(0,0,this.canvas.width,this.canvas.height),t.lineWidth=1}drawGrid(t,n,i){const r=this.canvas.getContext("2d");r.lineWidth=devicePixelRatio,r.strokeStyle="#eeeeee",r.beginPath();for(let e=0;e<t;e++){var a=n+e*i/(t-1);r.moveTo(a,0),r.lineTo(a,this.canvas.height)}r.stroke()}drawCurve(t,e,n,i,r,a){if(0<t.length){const l=this.canvas.getContext("2d");l.lineWidth=devicePixelRatio,l.strokeStyle=e,l.setLineDash([4*devicePixelRatio,4*devicePixelRatio]),l.beginPath(),l.moveTo(0,(1+a/(r-a))*this.canvas.height),l.lineTo(this.canvas.width,(1+a/(r-a))*this.canvas.height),l.stroke(),l.strokeStyle=e,l.setLineDash([]),l.beginPath();for(let e=0;e<t.length;e++){var s=t[e],o=n+e*i/(t.length-1),s=(1-(s-a)/(r-a))*this.canvas.height;0==e?l.moveTo(o,s):l.lineTo(o,s)}l.stroke()}}isTurningPoint(e,t){return 0<t&&Math.sign(e[t].dvddx)*Math.sign(e[t-1].dvddx)<=0}isPeak(e,t){return 0<t&&Math.sign(e[t].dvdx)*Math.sign(e[t-1].dvdx)<=0&&e[t].dvddx<=0}isValley(e,t){return 0<t&&Math.sign(e[t].dvdx)*Math.sign(e[t-1].dvdx)<=0&&0<e[t].dvddx}visualizeTurningPoint(n,i,r,a,s){if(0<n.length){const c=this.canvas.getContext("2d");for(let t=0;t<n.length;t++){let e;var o,l;this.isTurningPoint(n,t)?e={text:"t",color:"purple"}:this.isPeak(n,t)?e={text:"p",color:"green"}:this.isValley(n,t)&&(e={text:"v",color:"red"}),e&&(o=i+t*r/(n.length-1),l=(1-(n[t].value-s)/(a-s))*this.canvas.height,c.fillStyle=e.color,c.textAlign="center",c.font=`${10*devicePixelRatio}px sans-serif`,c.fillText(e.text,o,l))}}}}}(mycrypcryp=mycrypcryp||{}),function(e){function t(a){return a.map((e,t,n)=>{let i=0,r=0;return 0<t&&(i+=e-a[t-1],r++),t+1<a.length&&(i+=a[t+1]-e,r++),0!=r?i/r:0})}(e.helper||(e.helper={})).TrendWatcher=class{constructor(e,t=0,n){this.smoothItr=t,this._downSampling=n,this._rawData=e,this.resampling()}get high(){return this.data.reduce((e,t)=>Math.max(e,t.price),Number.MIN_VALUE)}get low(){return this.data.reduce((e,t)=>Math.min(e,t.price),Number.MAX_VALUE)}get lastProjectedPrice(){var e=this.high,t=this.low;return this.normalized.smoothedData.last.price*(e-t)+t}get downSampling(){return this._downSampling}set downSampling(e){this._downSampling!=e&&(this._downSampling=e,this.resampling())}resampling(){var e=function(r,e){const a=[];for(let i=0;i<r.length;i+=e){var s=Math.min(i+e,r.length);let t=0,n=0;for(let e=i;e<s;e++){const o=r[e];t+=o.price,n+=o.time.getTime()}t/=s-i,n/=s-i,a.push({price:t,time:new Date(n),open:r[i].open,close:r[s-1].close})}return a}(this._rawData,this._downSampling),e=function(e){if(0<e.length){const t=e.reduce((e,t)=>Math.min(e,t.price),e[0].price),n=e.reduce((e,t)=>Math.max(e,t.price),e[0].price);return e.map(e=>({price:(e.price-t)/(n-t),time:e.time,open:e.open,close:e.close}))}return e}(this.data=e);this.normalized={data:e,smoothedData:function(e,t){let a=e;for(let e=0;e<t;e++)a=a.map((e,t,n)=>{let i=e.price,r=1;return 0<t&&(i+=a[t-1].price,r++),t+1<a.length&&(i+=a[t+1].price,r++),{price:i/r,time:e.time,open:e.open,close:e.close}});return a}(e,this.smoothItr)},this.dDataDt=t(this.normalized.smoothedData.map(e=>e.price)),this.dDataDDt=t(this.dDataDt)}get lastDDataDt(){if(0<this.dDataDt.length)return this.dDataDt[this.dDataDt.length-1]}}}(mycrypcryp=mycrypcryp||{}),function(n){!function(e){class t{constructor(){this.loadingView=new n.view.Loading,this.count=0}begin(){0==this.count&&document.body.appendChild(this.loadingView.htmlElement),this.count++}end(){this.count--,0==this.count&&document.body.removeChild(this.loadingView.htmlElement)}}t.shared=new t,e.LoadingManager=t}(n.manager||(n.manager={}))}(mycrypcryp=mycrypcryp||{}),function(h){!function(e){const l=[{title:"last 3 years",dateFunc:function(){let e=new Date;return e.setFullYear(e.getFullYear()-3),e},downSampling:7},{title:"last 1 years",dateFunc:function(){let e=new Date;return e.setFullYear(e.getFullYear()-1),e},downSampling:7},{title:"last 6 months",dateFunc:function(){let e=new Date;return e.setMonth(e.getMonth()-6),e},downSampling:7},{title:"last 3 months",dateFunc:function(){let e=new Date;return e.setMonth(e.getMonth()-3),e},downSampling:7},{title:"last 14 days",dateFunc:function(){let e=new Date;return e.setTime(e.getTime()-12096e5),e},downSampling:1}],c=[{title:"peak/valley",value:"peak"},{title:"name",value:"name"},{title:"ratio",value:"ratio"}];e.Landing=class{constructor(){this.infoPanel=new h.view.InfoPanel,this.currentConversion=0,this.interval="1d",this.currentRangeIndex=0,this.openTime=l[0].dateFunc(),this.currentSortingIndex=0,this.sorting="peak",this.htmlElement=DanborutoriReact.createElement("div",{style:"position: relative;"}),this.dataByBaseAsset=new Map,this.trends=[],this.graphs=[],this.init()}init(){return __awaiter(this,void 0,void 0,function*(){h.manager.LoadingManager.shared.begin();const e=yield com.danborutori.cryptoApi.Binance.shared.getExchangeInfo(),t=e.symbols.filter(e=>e.quoteAsset==h.setting.AppSetting.shared.quoteAsset&&(h.setting.AppSetting.shared.assetWhiteList.has(e.baseAsset)||h.setting.AppSetting.shared.favourite.has(e.baseAsset))&&!(e.baseAsset.endsWith("UP")||e.baseAsset.endsWith("DOWN")));yield this.getData(t.map(e=>e.baseAsset));var n=this.getTrends();h.manager.LoadingManager.shared.end(),this.trends=n,this.refresh(),this.infoPanel.htmlElement.style.position="absolute",this.infoPanel.htmlElement.style.top="8",this.infoPanel.htmlElement.style.right="8",this.infoPanel.set(this.interval,1e3,10,20),this.htmlElement.appendChild(this.infoPanel.htmlElement)})}refresh(){return __awaiter(this,void 0,void 0,function*(){h.manager.LoadingManager.shared.begin(),yield this.getCurrentConversion(),h.manager.LoadingManager.shared.end();const n=this.trends.sort((e,t)=>{var n=(h.setting.AppSetting.shared.favourite.has(e.baseAsset)?-1:1)-(h.setting.AppSetting.shared.favourite.has(t.baseAsset)?-1:1);if(0!=n)return n;switch(this.sorting){case"peak":return Math.abs(e.trend.lastDDataDt)-Math.abs(t.trend.lastDDataDt);case"name":return e.baseAsset>t.baseAsset?1:e.baseAsset<t.baseAsset?-1:0;case"ratio":return-(e.trend.high/e.trend.low-t.trend.high/t.trend.low)}});this.htmlElement.innerHTML="",this.htmlElement.appendChild(DanborutoriReact.createElement("center",null,DanborutoriReact.createElement("div",{name:"header"},"1 ",h.setting.AppSetting.shared.quoteAsset," = ",this.currentConversion," ",h.setting.AppSetting.shared.currency,DanborutoriReact.createElement("br",null),DanborutoriReact.createElement("br",null),"range: ",DanborutoriReact.createElement("select",{onchange:e=>{e=e.target.selectedIndex;const t=l[e];this.currentRangeIndex=e,this.openTime=t.dateFunc(),this.redraw(n,t.downSampling)}},l.map((e,t)=>{const n=DanborutoriReact.createElement("option",null,e.title);return this.currentRangeIndex==t&&(n.selected=!0),n})),"  sort: ",DanborutoriReact.createElement("select",{onchange:e=>{e=e.target;this.currentSortingIndex=e.selectedIndex,this.sorting=c[e.selectedIndex].value,this.refresh()}},c.map((e,t)=>{const n=DanborutoriReact.createElement("option",null,e.title);return n.selected=t==this.currentSortingIndex,n})),DanborutoriReact.createElement("hr",null)),DanborutoriReact.createElement("div",{name:"graphDiv",style:"overflow-y: scroll;"})));const i=Math.max(this.openTime.getTime(),n.reduce((e,t)=>Math.min(e,t.trend.data.first.open.getTime()),Number.MAX_VALUE)),r=n.reduce((e,t)=>Math.max(e,t.trend.data.last.close.getTime()),Number.MIN_VALUE);let t=!1;const a=this.htmlElement.querySelector("div[name=graphDiv]"),e=n.map(e=>{var t=h.setting.AppSetting.shared.favourite.has(e.baseAsset);return this.createGraph(e.baseAsset,h.setting.AppSetting.shared.quoteAsset,e.trend,{open:new Date(i),close:new Date(r)},t)});e.forEach(e=>{e.isFavourite||t||(a.appendChild(DanborutoriReact.createElement("hr",null)),t=!0),a.appendChild(e.element),a.appendChild(DanborutoriReact.createElement("br",null))}),this.graphs=e.map(e=>e.graph),this.htmlElement.appendChild(this.infoPanel.htmlElement);const s=this.htmlElement.querySelector("div[name=header]");var o=s.getBoundingClientRect();a.style.height=`${innerHeight-o.height-30}px`})}getCurrentConversion(){return __awaiter(this,void 0,void 0,function*(){this.currentConversion=yield com.danborutori.cryptoApi.CryptoCompare.shared.getPrice(h.setting.AppSetting.shared.quoteAsset,h.setting.AppSetting.shared.currency)})}redraw(e,t){const n=Math.max(this.openTime.getTime(),e.reduce((e,t)=>Math.min(e,t.trend.data.first.open.getTime()),Number.MAX_VALUE)),i=e.reduce((e,t)=>Math.max(e,t.trend.data.last.close.getTime()),Number.MIN_VALUE);this.graphs.forEach(e=>e.update({open:new Date(n),close:new Date(i),downSampling:t}))}getData(e){return __awaiter(this,void 0,void 0,function*(){yield Promise.all(e.map(t=>__awaiter(this,void 0,void 0,function*(){var e=yield com.danborutori.cryptoApi.Binance.shared.getKlineCandlestickData(`${t}${h.setting.AppSetting.shared.quoteAsset}`,this.interval,{limit:1e3});-20<e.length&&this.dataByBaseAsset.set(t,e)})))})}getTrends(){const e=[];for(var t of this.dataByBaseAsset){var n=t[0];const i=t[1];e.push({baseAsset:n,trend:new h.helper.TrendWatcher(i.map(e=>({price:(e.low+e.high)/2,time:new Date((e.openTime.getTime()+e.closeTime.getTime())/2),open:e.openTime,close:e.closeTime})),10,l[0].downSampling)})}return e}createGraph(n,e,t,i,r){const a=new h.view.SymbolGraph(n,t,i,{currency:h.setting.AppSetting.shared.currency,ratio:this.currentConversion},(e,t)=>{this.addOrRemoveMarker(n,t,e),a.renderGraph()});return a.render(),{element:DanborutoriReact.createElement("div",{style:"display: inline-block;"},DanborutoriReact.createElement("div",{align:"left"},DanborutoriReact.createElement("b",null,n),DanborutoriReact.createElement("input",{onclick:e=>{const t=e.target;h.setting.AppSetting.shared.favourite.has(n)?(h.setting.AppSetting.shared.favourite.delete(n),t.value="☆"):(h.setting.AppSetting.shared.favourite.add(n),t.value="★"),h.setting.AppSetting.shared.commit()},type:"button",value:r?"★":"☆",style:"float: right;"})),a.htmlElement,DanborutoriReact.createElement("br",null),DanborutoriReact.createElement("br",null)),graph:a,isFavourite:r}}addOrRemoveMarker(e,t,n){const i=h.setting.AppSetting.shared.markers.get(e)||[];var r=i.findIndex(e=>Math.abs(e.getTime()-n.getTime())<=t);0<=r?i.remove(r):(i.push(n),h.setting.AppSetting.shared.markers.set(e,i)),h.setting.AppSetting.shared.commit()}}}(h.scene||(h.scene={}))}(mycrypcryp=mycrypcryp||{}),function(e){!function(e){const t=["BTC","ETH","BNB","BUSD","USDT","TUSD","iINCH","AAVE","ADA","ADXOLD","ALGO","ALPHA","ANTOLD","ATOM","AUD","AUDIO","BAL","BAND","BAT","BCH","BEAM","BGBP","BOT","BRL","BTT","CHZ","COMP","CRV","DAI","DASH","DOGE","DOT","DREPOLD","ENJ","EOS","ERD","ETC","EUR","FIL","FTM","GBP","GNT","GRT","HBAR","HNT","JST","KNC","LEND","LINK","LOOMOLD","LTC","LUNA","MATIC","MITH","MKR","NEO","NGN","NPXS","OMGOMOLD","ONT","PAX","PAXG","PERLOD","QTUM","REN","REPV1","RSR","RUNE","SNX","SOL","SRM","SUN","SUSHU","SXP","TOMO","TRX","TRY","UNI","VET","WAVES","WBNB","WETH","WRX","XLM","XMR","XRP","XTZ","XVG","YFI","YFII","ZEC","ZEN"];class n{constructor(){this.localStorageKey="mycrypcryp.setting.AppSetting.data",this.markers=new Map;try{this._data=JSON.parse(localStorage.getItem(this.localStorageKey))||{}}catch(e){this._data={}}for(var e in this.favourite=new Set(this._data.favourite||["BTC","ETH","PAXG"]),this.assetWhiteList=new Set(this._data.assetWhiteList||t),this._data.markers||{})this.markers.set(e,this._data.markers[e].map(e=>new Date(e)))}get currency(){return this._data.currency||"HKD"}get quoteAsset(){return this._data.quoteAsset||"USDT"}updateInternalData(){this._data.favourite=Array.from(this.favourite.keys()),this._data.markers=this._data.markers||{};for(var e of this.markers)this._data.markers[e[0]]=e[1].map(e=>e.getTime())}commit(){this.updateInternalData(),localStorage.setItem(this.localStorageKey,JSON.stringify(this._data))}export(){return this.updateInternalData(),btoa(JSON.stringify(this._data))}import(e){localStorage.setItem(this.localStorageKey,atob(e)),location.reload()}}n.shared=new n,e.AppSetting=n}(e.setting||(e.setting={}))}(mycrypcryp=mycrypcryp||{}),function(n){(n.view||(n.view={})).InfoPanel=class{constructor(){this.htmlElement=DanborutoriReact.createElement("div",{align:"right",style:"display: inline-block; background-color: white; padding: 4px; border: 1px solid black; border-radius: 4px;"}),this.isExpand=!1,this.htmlElement.onclick=e=>{this.isExpand=!this.isExpand,this.refresh()},this.refresh()}set(e,t,n,i){this.interval=e,this.limit=t,this.smoothItr=n,this.minimumSample=i,this.refresh()}refresh(){this.isExpand?(this.htmlElement.innerHTML="",this.htmlElement.appendChild(DanborutoriReact.createElement("div",null,"info",DanborutoriReact.createElement("br",null),"interval: ",this.interval," limit: ",this.limit,DanborutoriReact.createElement("br",null),"smoothItr: ",this.smoothItr," minimum sample: ",this.minimumSample,DanborutoriReact.createElement("br",null),DanborutoriReact.createElement("br",null),DanborutoriReact.createElement("font",{size:"2"},"version ",n.version),DanborutoriReact.createElement("br",null),"setting: ",DanborutoriReact.createElement("input",{type:"button",value:"export",onclick:e=>__awaiter(this,void 0,void 0,function*(){var e=n.setting.AppSetting.shared.export();n.manager.LoadingManager.shared.begin(),yield navigator.clipboard.writeText(e),n.manager.LoadingManager.shared.end()})}),DanborutoriReact.createElement("input",{type:"button",value:"import",onclick:e=>{var t=prompt("Please paste setting string here:");t&&n.setting.AppSetting.shared.import(t)}})))):this.htmlElement.innerHTML="info"}}}(mycrypcryp=mycrypcryp||{}),function(d){(d.view||(d.view={})).SymbolGraph=class{constructor(e,t,n,i,r){this.baseAsset=e,this.trend=t,this.range=n,this.quoteToCurrency=i,this.onClick=r,this.htmlElement=DanborutoriReact.createElement("div",{style:"display: inline-block"},DanborutoriReact.createElement("div",{style:"display: inline-block"},DanborutoriReact.createElement("canvas",{name:"graphCanvas",width:200*devicePixelRatio,height:100*devicePixelRatio,style:"width: 200px; height: 100px;"}),DanborutoriReact.createElement("div",null,DanborutoriReact.createElement("font",{size:"2"},DanborutoriReact.createElement("div",{name:"from",style:"display: inline-block; float:left;"},"from 2"),DanborutoriReact.createElement("div",{name:"to",style:"float:right;"},"to")))),DanborutoriReact.createElement("div",{align:"left"},DanborutoriReact.createElement("font",{size:"2"},DanborutoriReact.createElement("div",{name:"info",align:"left",style:"display: inline-block;"}))));const a=this.htmlElement.querySelector("canvas[name=graphCanvas]");a.addEventListener("pointermove",e=>{this.onMouseMove(e.offsetX)},{passive:!0}),a.addEventListener("pointerleave",e=>{this.onMouseOut()},{passive:!0}),a.addEventListener("pointerout",e=>{this.onMouseOut()},{passive:!0}),a.addEventListener("pointerdown",e=>{this.onMouseDown(e.offsetX,e.target)},{passive:!0})}update(e){this.range.open=e.open,this.range.close=e.close,this.trend.downSampling=e.downSampling,this.render()}updateInfo(e){const t=this.htmlElement.querySelector("div[name=info]"),n=e.data.filter(e=>!(e.open>this.range.close||e.close<this.range.open));var i=n.reduce((e,t)=>Math.max(e,t.price),Number.MIN_VALUE),r=n.reduce((e,t)=>Math.min(e,t.price),Number.MAX_VALUE);t.innerHTML="",t.appendChild(DanborutoriReact.createElement("div",null,"H/L: ",(i/r).toFixed(5)," samples: ",e.data.length,DanborutoriReact.createElement("br",null),"high: ",(i*this.quoteToCurrency.ratio).toFixed(5),this.quoteToCurrency.currency,DanborutoriReact.createElement("br",null),"low: ",(r*this.quoteToCurrency.ratio).toFixed(5),this.quoteToCurrency.currency,DanborutoriReact.createElement("br",null),"last proj: ",(e.lastProjectedPrice*this.quoteToCurrency.ratio).toFixed(5)))}render(){this.renderGraph();const e=this.htmlElement.querySelector("div[name=from]"),t=this.htmlElement.querySelector("div[name=to]");e.innerText=moment(this.range.open).format("MMMyyyy"),t.innerText=moment(this.range.close).format("MMMyyyy")}renderGraph(e){const t=this.htmlElement.querySelector("canvas[name=graphCanvas]"),n=this.trend;this.updateInfo(n);const i=(n.data.first.time.getTime()-this.range.open.getTime())*t.width/(this.range.close.getTime()-this.range.open.getTime());var r=(n.data.last.time.getTime()-this.range.open.getTime())*t.width/(this.range.close.getTime()-this.range.open.getTime())-i,a=n.data.findIndex(e=>e.close>=this.range.open),s=n.data.findIndex(e=>e.close>=this.range.close);const o=new d.helper.GraphDrawer(t);o.drawCurve(n.data.map(e=>e.price),"grey",i,r,n.data.slice(a,s).reduce((e,t)=>Math.max(e,t.price),Number.MIN_VALUE),n.data.slice(a,s).reduce((e,t)=>Math.min(e,t.price),Number.MAX_VALUE));var l,c=n.normalized.data.slice(a,s).reduce((e,t)=>Math.max(e,t.price),Number.MIN_VALUE),s=n.normalized.data.slice(a,s).reduce((e,t)=>Math.min(e,t.price),Number.MAX_VALUE);o.drawCurve(n.normalized.smoothedData.map(e=>e.price),"green",i,r,c,s),o.visualizeTurningPoint(n.normalized.smoothedData.map((e,t)=>({value:e.price,dvdx:n.dDataDt[t],dvddx:n.dDataDDt[t]})),i,r,c,s);const h=t.getContext("2d");for(l of d.setting.AppSetting.shared.markers.get(this.baseAsset)||[]){h.strokeStyle="#ffaaaa",h.lineWidth=devicePixelRatio;const i=(l.getTime()-this.range.open.getTime())*t.width/(this.range.close.getTime()-this.range.open.getTime());h.beginPath(),h.moveTo(i,0),h.lineTo(i,t.height),h.stroke()}null!=e&&(h.strokeStyle="black",h.lineWidth=devicePixelRatio,h.beginPath(),h.moveTo(e,0),h.lineTo(e,t.height),h.stroke(),h.fillStyle="black",s=e*(this.range.close.getTime()-this.range.open.getTime())/t.width+this.range.open.getTime(),h.fillText(moment(s).format("D MMM"),e,t.height))}onMouseMove(e){this.renderGraph(e*devicePixelRatio)}onMouseOut(){this.renderGraph()}onMouseDown(e,t){var n=10*devicePixelRatio,e=new Date(e*devicePixelRatio*(this.range.close.getTime()-this.range.open.getTime())/t.width+this.range.open.getTime()),t=(this.range.close.getTime()-this.range.open.getTime())*n/t.width;this.onClick(e,t)}}}(mycrypcryp=mycrypcryp||{});