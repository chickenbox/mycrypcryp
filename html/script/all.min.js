var com,DanborutoriReact,mycrypcryp,__awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})};!function(e){let t;!function(e){e.Loading=class{constructor(){this.htmlElement=DanborutoriReact.createElement("div",{style:"position: absolute; left: 50%; top: 50%; transform: translate(-50%,-50%); background-color: white; border-radius: 4px; padding: 4px;"},"loading")}}}(t=e.view||(e.view={}))}(mycrypcryp||(mycrypcryp={})),function(e){let t;!function(e){let t;!function(e){class t{fullUrl(e){return`https://api.binance.com/api/v3${e}`}getExchangeInfo(){return __awaiter(this,void 0,void 0,function*(){return yield(yield fetch(this.fullUrl("/exchangeInfo"))).json()})}getKlineCandlestickData(e,t,n){return __awaiter(this,void 0,void 0,function*(){const i=new URLSearchParams({symbol:e,interval:t});n=n||{};for(let e in n)i.append(e,n[e]);return(yield(yield fetch(this.fullUrl("/klines")+"?"+i)).json()).map(e=>({openTime:new Date(e[0]),open:parseFloat(e[1]),high:parseFloat(e[2]),low:parseFloat(e[3]),close:parseFloat(e[4]),volume:parseFloat(e[5]),closeTime:new Date(e[6]),quoteAssetVolume:parseFloat(e[7]),numberOfTrades:parseInt(e[8]),takerBuyBaseAssetVolume:parseFloat(e[9]),takerBuyQuoteAssetVolume:parseFloat(e[10])}))})}}t.shared=new t,e.Binance=t}(t=e.cryptoApi||(e.cryptoApi={}))}(t=e.danborutori||(e.danborutori={}))}(com||(com={})),function(e){let t;!function(e){let t;!function(e){class t{getPrice(e,t){return __awaiter(this,void 0,void 0,function*(){return(yield(yield fetch(`https://min-api.cryptocompare.com/data/price?fsym=${e}&tsyms=${t}`)).json())[t]})}}t.shared=new t,e.CryptoCompare=t}(t=e.cryptoApi||(e.cryptoApi={}))}(t=e.danborutori||(e.danborutori={}))}(com||(com={})),function(e){e.createElement=function(t,n,...i){let r;switch(t){case"button":r=e.createElement("input",{type:"button"});break;case"checkbox":r=e.createElement("input",{type:"checkbox"});break;case"radio":r=e.createElement("input",{type:"radio"});break;case"file":r=e.createElement("input",{type:"file"});break;case"scroll":(r=e.createElement("div",null)).style.overflow="scroll";break;case"slider":r=e.createElement("input",{type:"range"});break;default:r=document.createElement(t)}if(n)for(let e in n)n.hasOwnProperty(e)&&(e.startsWith("on")?r.addEventListener(e.substring(2),n[e]):r.setAttribute(e,n[e]));let a=i.flatMap(e=>e);for(let e of a)if(e instanceof HTMLElement)r.appendChild(e);else{let t=document.createTextNode(e);r.appendChild(t)}return r}}(DanborutoriReact||(DanborutoriReact={})),Object.defineProperty(Array.prototype,"first",{get(){return this.length>0?this[0]:null}}),Object.defineProperty(Array.prototype,"last",{get(){return this.length>0?this[this.length-1]:null}}),Array.prototype.findClosestIndex=function(e,t){let n=-1,i=1/0;for(let t=0;t<this.length;t++){const r=e(this[t],t);r<i&&(i=r,n=t)}return t&&(t.minDistance=i),n},Array.prototype.insert=function(e,t){this.splice(t,0,e)},Array.prototype.remove=function(e){const t=this[e];return this.splice(e,1),t},Array.prototype.swap=function(e,t){const n=this[e];this[e]=this[t],this[t]=n},Array.prototype.clear=function(){this.length=0},Array.prototype.pushAll=function(e){for(let t of e)this.push(t)},Array.prototype.flatMap=function(e){let t=new Array;for(let n=0;n<this.length;n++){let i=e(this[n],n);if(i instanceof Array)for(let e of i)null!=e&&null!=e&&t.push(e);else null!=i&&null!=i&&t.push(i)}return t},function(e){e.version="0.0.1";e.App=class{run(){return __awaiter(this,void 0,void 0,function*(){document.body.append((new e.scene.Landing).htmlElement)})}}}(mycrypcryp||(mycrypcryp={})),function(e){let t;!function(e){e.GraphDrawer=class{constructor(e){this.canvas=e;const t=this.canvas.getContext("2d");t.fillStyle="white",t.fillRect(0,0,this.canvas.width,this.canvas.height),t.lineWidth=1}drawGrid(e,t,n){const i=this.canvas.getContext("2d");i.lineWidth=devicePixelRatio,i.strokeStyle="#eeeeee",i.beginPath();for(let r=0;r<e;r++){const a=t+r*n/(e-1);i.moveTo(a,0),i.lineTo(a,this.canvas.height)}i.stroke()}drawCurve(e,t,n,i,r,a){if(e.length>0){const o=this.canvas.getContext("2d");o.lineWidth=devicePixelRatio,o.strokeStyle=t,o.setLineDash([4*devicePixelRatio,4*devicePixelRatio]),o.beginPath(),o.moveTo(0,(1+a/(r-a))*this.canvas.height),o.lineTo(this.canvas.width,(1+a/(r-a))*this.canvas.height),o.stroke(),o.strokeStyle=t,o.setLineDash([]),o.beginPath();for(let t=0;t<e.length;t++){const s=e[t],l=n+t*i/(e.length-1),c=(1-(s-a)/(r-a))*this.canvas.height;0==t?o.moveTo(l,c):o.lineTo(l,c)}o.stroke()}}isTurningPoint(e,t){return t>0&&Math.sign(e[t].dvddx)*Math.sign(e[t-1].dvddx)<=0}isPeak(e,t){return t>0&&Math.sign(e[t].dvdx)*Math.sign(e[t-1].dvdx)<=0&&e[t].dvddx<=0}isValley(e,t){return t>0&&Math.sign(e[t].dvdx)*Math.sign(e[t-1].dvdx)<=0&&e[t].dvddx>0}visualizeTurningPoint(e,t,n,i,r){if(e.length>0){const a=this.canvas.getContext("2d");for(let o=0;o<e.length;o++){let s;if(this.isTurningPoint(e,o)?s={text:"t",color:"purple"}:this.isPeak(e,o)?s={text:"p",color:"green"}:this.isValley(e,o)&&(s={text:"v",color:"red"}),s){const l=t+o*n/(e.length-1),c=(1-(e[o].value-r)/(i-r))*this.canvas.height;a.fillStyle=s.color,a.textAlign="center",a.font=`${10*devicePixelRatio}px sans-serif`,a.fillText(s.text,l,c)}}}}}}(t=e.helper||(e.helper={}))}(mycrypcryp||(mycrypcryp={})),function(e){let t;!function(e){function t(e){return e.map((t,n,i)=>{let r=0,a=0;return n>0&&(r+=t-e[n-1],a++),n+1<e.length&&(r+=e[n+1]-t,a++),0!=a?r/a:0})}e.TrendWatcher=class{constructor(e,t=0,n){this.smoothItr=t,this._downSampling=n,this._rawData=e,this.resampling()}get high(){return this.data.reduce((e,t)=>Math.max(e,t.price),Number.MIN_VALUE)}get low(){return this.data.reduce((e,t)=>Math.min(e,t.price),Number.MAX_VALUE)}get lastProjectedPrice(){const e=this.high,t=this.low;return this.normalized.smoothedData.last.price*(e-t)+t}get downSampling(){return this._downSampling}set downSampling(e){this._downSampling!=e&&(this._downSampling=e,this.resampling())}resampling(){const e=function(e,t){const n=[];for(let i=0;i<e.length;i+=t){const r=Math.min(i+t,e.length);let a=0,o=0;for(let t=i;t<r;t++){const n=e[t];a+=n.price,o+=n.time.getTime()}a/=r-i,o/=r-i,n.push({price:a,time:new Date(o),open:e[i].open,close:e[r-1].close})}return n}(this._rawData,this._downSampling);this.data=e;const n=function(e){if(e.length>0){const t=e.reduce((e,t)=>Math.min(e,t.price),e[0].price),n=e.reduce((e,t)=>Math.max(e,t.price),e[0].price);return e.map(e=>({price:(e.price-t)/(n-t),time:e.time,open:e.open,close:e.close}))}return e}(e);this.normalized={data:n,smoothedData:function(e,t){let n=e;for(let e=0;e<t;e++)n=n.map((e,t,i)=>{let r=e.price,a=1;if(t>0)r+=n[t-1].price,a++;else if(t+1<n.length){const e=n[t+1].price-n[t].price;r+=n[t].price-e,a++}if(t+1<n.length)r+=n[t+1].price,a++;else if(t-1>=0){const e=n[t-1].price-n[t].price;r+=n[t].price-e,a++}return{price:r/a,time:e.time,open:e.open,close:e.close}});return n}(n,this.smoothItr)},this.dDataDt=t(this.normalized.smoothedData.map(e=>e.price)),this.dDataDDt=t(this.dDataDt)}get lastDDataDt(){if(this.dDataDt.length>0)return this.dDataDt[this.dDataDt.length-1]}}}(t=e.helper||(e.helper={}))}(mycrypcryp||(mycrypcryp={})),function(e){let t;!function(t){class n{constructor(){this.loadingView=new e.view.Loading,this.count=0}begin(){0==this.count&&document.body.appendChild(this.loadingView.htmlElement),this.count++}end(){this.count--,0==this.count&&document.body.removeChild(this.loadingView.htmlElement)}}n.shared=new n,t.LoadingManager=n}(t=e.manager||(e.manager={}))}(mycrypcryp||(mycrypcryp={})),function(e){let t;!function(t){const n=10,i=1e3,r=20,a=[{title:"last 3 years",dateFunc:function(){let e=new Date;return e.setFullYear(e.getFullYear()-3),e},downSampling:7},{title:"last 1 years",dateFunc:function(){let e=new Date;return e.setFullYear(e.getFullYear()-1),e},downSampling:7},{title:"last 6 months",dateFunc:function(){let e=new Date;return e.setMonth(e.getMonth()-6),e},downSampling:7},{title:"last 3 months",dateFunc:function(){let e=new Date;return e.setMonth(e.getMonth()-3),e},downSampling:7},{title:"last month",dateFunc:function(){let e=new Date;return e.setMonth(e.getMonth()-1),e},downSampling:1},{title:"last 14 days",dateFunc:function(){let e=new Date;return e.setTime(e.getTime()-12096e5),e},downSampling:1}],o=[{title:"peak/valley",value:"peak"},{title:"name",value:"name"},{title:"ratio",value:"ratio"}];t.Landing=class{constructor(){this.infoPanel=new e.view.InfoPanel,this.currentConversion=0,this.interval="1d",this.currentRangeIndex=0,this.openTime=a[0].dateFunc(),this.currentSortingIndex=0,this.sorting="peak",this.htmlElement=DanborutoriReact.createElement("div",{style:"position: relative;"}),this.dataByBaseAsset=new Map,this.trends=[],this.graphs=[],this.init()}init(){return __awaiter(this,void 0,void 0,function*(){e.manager.LoadingManager.shared.begin();const t=(yield com.danborutori.cryptoApi.Binance.shared.getExchangeInfo()).symbols.filter(t=>t.quoteAsset==e.setting.AppSetting.shared.quoteAsset&&!(t.baseAsset.endsWith("UP")||t.baseAsset.endsWith("DOWN")));yield this.getData(t.map(e=>e.baseAsset));const a=this.getTrends();e.manager.LoadingManager.shared.end(),this.trends=a,this.refresh(),this.infoPanel.htmlElement.style.position="absolute",this.infoPanel.htmlElement.style.top="8",this.infoPanel.htmlElement.style.right="8",this.infoPanel.set(this.interval,i,n,r),this.htmlElement.appendChild(this.infoPanel.htmlElement)})}refresh(){return __awaiter(this,void 0,void 0,function*(){e.manager.LoadingManager.shared.begin(),yield this.getCurrentConversion(),e.manager.LoadingManager.shared.end();const t=this.trends.sort((t,n)=>{let i=(e.setting.AppSetting.shared.favourite.has(t.baseAsset)?-1:1)-(e.setting.AppSetting.shared.favourite.has(n.baseAsset)?-1:1);if(0!=i)return i;const r=e.setting.AppSetting.shared.markers.get(t.baseAsset)||[];if(0!=(i=(e.setting.AppSetting.shared.markers.get(n.baseAsset)||[]).length-r.length))return i;switch(this.sorting){case"peak":return Math.abs(t.trend.lastDDataDt)-Math.abs(n.trend.lastDDataDt);case"name":return t.baseAsset>n.baseAsset?1:t.baseAsset<n.baseAsset?-1:0;case"ratio":return-(t.trend.high/t.trend.low-n.trend.high/n.trend.low)}});this.htmlElement.innerHTML="",this.htmlElement.appendChild(DanborutoriReact.createElement("center",null,DanborutoriReact.createElement("div",{name:"header"},"1 ",e.setting.AppSetting.shared.quoteAsset," = ",this.currentConversion," ",e.setting.AppSetting.shared.currency,DanborutoriReact.createElement("br",null),DanborutoriReact.createElement("br",null),"range: ",DanborutoriReact.createElement("select",{onchange:e=>{const n=e.target.selectedIndex,i=a[n];this.currentRangeIndex=n,this.openTime=i.dateFunc(),this.redraw(t,i.downSampling)}},a.map((e,t)=>{const n=DanborutoriReact.createElement("option",null,e.title);return this.currentRangeIndex==t&&(n.selected=!0),n})),"  sort: ",DanborutoriReact.createElement("select",{onchange:e=>{const t=e.target;this.currentSortingIndex=t.selectedIndex,this.sorting=o[t.selectedIndex].value,this.refresh()}},o.map((e,t)=>{const n=DanborutoriReact.createElement("option",null,e.title);return n.selected=t==this.currentSortingIndex,n})),DanborutoriReact.createElement("hr",null)),DanborutoriReact.createElement("div",{name:"graphDiv",style:"overflow-y: scroll;"})));const n=Math.max(this.openTime.getTime(),t.reduce((e,t)=>Math.min(e,t.trend.data.first.open.getTime()),Number.MAX_VALUE)),i=t.reduce((e,t)=>Math.max(e,t.trend.data.last.close.getTime()),Number.MIN_VALUE);let r=!1;const s=this.htmlElement.querySelector("div[name=graphDiv]"),l=t.map(t=>{const r=e.setting.AppSetting.shared.favourite.has(t.baseAsset);return this.createGraph(t.baseAsset,e.setting.AppSetting.shared.quoteAsset,t.trend,{open:new Date(n),close:new Date(i)},r)});l.forEach(e=>{e.isFavourite||r||(s.appendChild(DanborutoriReact.createElement("hr",null)),r=!0),s.appendChild(e.element),s.appendChild(DanborutoriReact.createElement("br",null))}),this.graphs=l.map(e=>e.graph),this.htmlElement.appendChild(this.infoPanel.htmlElement);const c=this.htmlElement.querySelector("div[name=header]").getBoundingClientRect();s.style.height=`${innerHeight-c.height-30}px`})}getCurrentConversion(){return __awaiter(this,void 0,void 0,function*(){this.currentConversion=yield com.danborutori.cryptoApi.CryptoCompare.shared.getPrice(e.setting.AppSetting.shared.quoteAsset,e.setting.AppSetting.shared.currency)})}redraw(e,t){const n=Math.max(this.openTime.getTime(),e.reduce((e,t)=>Math.min(e,t.trend.data.first.open.getTime()),Number.MAX_VALUE)),i=e.reduce((e,t)=>Math.max(e,t.trend.data.last.close.getTime()),Number.MIN_VALUE);this.graphs.forEach(e=>e.update({open:new Date(n),close:new Date(i),downSampling:t}))}getData(t){return __awaiter(this,void 0,void 0,function*(){yield Promise.all(t.map(t=>__awaiter(this,void 0,void 0,function*(){const n=yield com.danborutori.cryptoApi.Binance.shared.getKlineCandlestickData(`${t}${e.setting.AppSetting.shared.quoteAsset}`,this.interval,{limit:i});n.length>-r&&this.dataByBaseAsset.set(t,n)})))})}getTrends(){const t=[];for(let i of this.dataByBaseAsset){const r=i[0],o=i[1];t.push({baseAsset:r,trend:new e.helper.TrendWatcher(o.map(e=>({price:(e.low+e.high)/2,time:new Date((e.openTime.getTime()+e.closeTime.getTime())/2),open:e.openTime,close:e.closeTime})),n,a[0].downSampling)})}return t}createGraph(t,n,i,r,a){const o=new e.view.SymbolGraph(t,i,r,{currency:e.setting.AppSetting.shared.currency,ratio:this.currentConversion},(e,n)=>{this.addOrRemoveMarker(t,n,e),o.renderGraph()});return o.render(),{element:DanborutoriReact.createElement("div",{style:"display: inline-block;"},DanborutoriReact.createElement("div",{align:"left"},DanborutoriReact.createElement("b",null,t),DanborutoriReact.createElement("input",{onclick:n=>{const i=n.target;e.setting.AppSetting.shared.favourite.has(t)?(e.setting.AppSetting.shared.favourite.delete(t),i.value="☆"):(e.setting.AppSetting.shared.favourite.add(t),i.value="★"),e.setting.AppSetting.shared.commit()},type:"button",value:a?"★":"☆",style:"float: right;"})),o.htmlElement,DanborutoriReact.createElement("br",null),DanborutoriReact.createElement("br",null)),graph:o,isFavourite:a}}addOrRemoveMarker(t,n,i){const r=e.setting.AppSetting.shared.markers.get(t)||[],a=r.findIndex(e=>Math.abs(e.getTime()-i.getTime())<=n);a>=0?r.remove(a):(r.push(i),e.setting.AppSetting.shared.markers.set(t,r)),e.setting.AppSetting.shared.commit()}}}(t=e.scene||(e.scene={}))}(mycrypcryp||(mycrypcryp={})),function(e){let t;!function(e){class t{constructor(){this.localStorageKey="mycrypcryp.setting.AppSetting.data",this.markers=new Map;try{this._data=JSON.parse(localStorage.getItem(this.localStorageKey))||{}}catch(e){this._data={}}this.favourite=new Set(this._data.favourite||["BTC","ETH","PAXG"]);for(let e in this._data.markers||{})this.markers.set(e,this._data.markers[e].map(e=>new Date(e)))}get currency(){return this._data.currency||"HKD"}get quoteAsset(){return this._data.quoteAsset||"USDT"}updateInternalData(){this._data.favourite=Array.from(this.favourite.keys()),this._data.markers=this._data.markers||{};for(let e of this.markers)this._data.markers[e[0]]=e[1].map(e=>e.getTime())}commit(){this.updateInternalData(),localStorage.setItem(this.localStorageKey,JSON.stringify(this._data))}export(){return this.updateInternalData(),btoa(JSON.stringify(this._data))}import(e){localStorage.setItem(this.localStorageKey,atob(e)),location.reload()}}t.shared=new t,e.AppSetting=t}(t=e.setting||(e.setting={}))}(mycrypcryp||(mycrypcryp={})),function(e){let t;!function(t){t.InfoPanel=class{constructor(){this.htmlElement=DanborutoriReact.createElement("div",{align:"right",style:"display: inline-block; background-color: white; padding: 4px; border: 1px solid black; border-radius: 4px;"}),this.isExpand=!1,this.htmlElement.onclick=(e=>{this.isExpand=!this.isExpand,this.refresh()}),this.refresh()}set(e,t,n,i){this.interval=e,this.limit=t,this.smoothItr=n,this.minimumSample=i,this.refresh()}refresh(){this.isExpand?(this.htmlElement.innerHTML="",this.htmlElement.appendChild(DanborutoriReact.createElement("div",null,"info",DanborutoriReact.createElement("br",null),"interval: ",this.interval," limit: ",this.limit,DanborutoriReact.createElement("br",null),"smoothItr: ",this.smoothItr," minimum sample: ",this.minimumSample,DanborutoriReact.createElement("br",null),DanborutoriReact.createElement("br",null),DanborutoriReact.createElement("font",{size:"2"},"version ",e.version),DanborutoriReact.createElement("br",null),"setting: ",DanborutoriReact.createElement("input",{type:"button",value:"export",onclick:t=>__awaiter(this,void 0,void 0,function*(){const t=e.setting.AppSetting.shared.export(),n=DanborutoriReact.createElement("div",{style:"position: absolute; left: 50%; top: 50%; transform: translate(-50%,-50%);"},DanborutoriReact.createElement("center",null,DanborutoriReact.createElement("textarea",{rows:"4",cols:"50"},t),DanborutoriReact.createElement("br",null),DanborutoriReact.createElement("input",{type:"button",value:"close",onclick:e=>{document.body.removeChild(n)}})));document.body.appendChild(n)})}),DanborutoriReact.createElement("input",{type:"button",value:"import",onclick:t=>{const n=prompt("Please paste setting string here:");n&&e.setting.AppSetting.shared.import(n)}})))):this.htmlElement.innerHTML="info"}}}(t=e.view||(e.view={}))}(mycrypcryp||(mycrypcryp={})),function(e){let t;!function(t){t.SymbolGraph=class{constructor(e,t,n,i,r){this.baseAsset=e,this.trend=t,this.range=n,this.quoteToCurrency=i,this.onClick=r,this.htmlElement=DanborutoriReact.createElement("div",{style:"display: inline-block"},DanborutoriReact.createElement("div",{style:"display: inline-block"},DanborutoriReact.createElement("canvas",{name:"graphCanvas",width:200*devicePixelRatio,height:100*devicePixelRatio,style:"width: 200px; height: 100px;"}),DanborutoriReact.createElement("div",null,DanborutoriReact.createElement("font",{size:"2"},DanborutoriReact.createElement("div",{name:"from",style:"display: inline-block; float:left;"},"from 2"),DanborutoriReact.createElement("div",{name:"to",style:"float:right;"},"to")))),DanborutoriReact.createElement("div",{align:"left"},DanborutoriReact.createElement("font",{size:"2"},DanborutoriReact.createElement("div",{name:"info",align:"left",style:"display: inline-block;"}))));const a=this.htmlElement.querySelector("canvas[name=graphCanvas]");a.addEventListener("pointermove",e=>{this.onMouseMove(e.offsetX)},{passive:!0}),a.addEventListener("pointerleave",e=>{this.onMouseOut()},{passive:!0}),a.addEventListener("pointerout",e=>{this.onMouseOut()},{passive:!0}),a.addEventListener("pointerdown",e=>{this.onMouseDown(e.offsetX,e.target)},{passive:!0})}update(e){this.range.open=e.open,this.range.close=e.close,this.trend.downSampling=e.downSampling,this.render()}updateInfo(e){const t=this.htmlElement.querySelector("div[name=info]"),n=e.data.filter(e=>!(e.open>this.range.close||e.close<this.range.open)),i=n.reduce((e,t)=>Math.max(e,t.price),Number.MIN_VALUE),r=n.reduce((e,t)=>Math.min(e,t.price),Number.MAX_VALUE);t.innerHTML="",t.appendChild(DanborutoriReact.createElement("div",null,"H/L: ",(i/r).toFixed(5)," samples: ",e.data.length,DanborutoriReact.createElement("br",null),"high: ",(i*this.quoteToCurrency.ratio).toFixed(5),this.quoteToCurrency.currency,DanborutoriReact.createElement("br",null),"low: ",(r*this.quoteToCurrency.ratio).toFixed(5),this.quoteToCurrency.currency,DanborutoriReact.createElement("br",null),"last proj: ",(e.lastProjectedPrice*this.quoteToCurrency.ratio).toFixed(5)))}render(){this.renderGraph();const e=this.htmlElement.querySelector("div[name=from]"),t=this.htmlElement.querySelector("div[name=to]");e.innerText=moment(this.range.open).format("MMMyyyy"),t.innerText=moment(this.range.close).format("MMMyyyy")}renderGraph(t){const n=this.htmlElement.querySelector("canvas[name=graphCanvas]"),i=this.trend;this.updateInfo(i);const r=(i.data.first.time.getTime()-this.range.open.getTime())*n.width/(this.range.close.getTime()-this.range.open.getTime()),a=(i.data.last.time.getTime()-this.range.open.getTime())*n.width/(this.range.close.getTime()-this.range.open.getTime())-r,o=i.data.findIndex(e=>e.close>=this.range.open),s=i.data.findIndex(e=>e.close>=this.range.close),l=new e.helper.GraphDrawer(n);l.drawCurve(i.data.map(e=>e.price),"grey",r,a,i.data.slice(o,s).reduce((e,t)=>Math.max(e,t.price),Number.MIN_VALUE),i.data.slice(o,s).reduce((e,t)=>Math.min(e,t.price),Number.MAX_VALUE));const c=i.normalized.data.slice(o,s).reduce((e,t)=>Math.max(e,t.price),Number.MIN_VALUE),h=i.normalized.data.slice(o,s).reduce((e,t)=>Math.min(e,t.price),Number.MAX_VALUE);l.drawCurve(i.normalized.smoothedData.map(e=>e.price),"green",r,a,c,h),l.visualizeTurningPoint(i.normalized.smoothedData.map((e,t)=>({value:e.price,dvdx:i.dDataDt[t],dvddx:i.dDataDDt[t]})),r,a,c,h);const d=n.getContext("2d"),p=e.setting.AppSetting.shared.markers.get(this.baseAsset)||[];for(let e of p){d.strokeStyle="#ffaaaa",d.lineWidth=devicePixelRatio;const t=(e.getTime()-this.range.open.getTime())*n.width/(this.range.close.getTime()-this.range.open.getTime());d.beginPath(),d.moveTo(t,0),d.lineTo(t,n.height),d.stroke()}if(null!=t){d.strokeStyle="black",d.lineWidth=devicePixelRatio,d.beginPath(),d.moveTo(t,0),d.lineTo(t,n.height),d.stroke(),d.fillStyle="black";const e=t*(this.range.close.getTime()-this.range.open.getTime())/n.width+this.range.open.getTime();d.fillText(moment(e).format("D MMM"),t,n.height)}}onMouseMove(e){this.renderGraph(e*devicePixelRatio)}onMouseOut(){this.renderGraph()}onMouseDown(e,t){const n=10*devicePixelRatio,i=new Date(e*devicePixelRatio*(this.range.close.getTime()-this.range.open.getTime())/t.width+this.range.open.getTime()),r=(this.range.close.getTime()-this.range.open.getTime())*n/t.width;this.onClick(i,r)}}}(t=e.view||(e.view={}))}(mycrypcryp||(mycrypcryp={}));